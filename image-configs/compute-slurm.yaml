options:
  layer_type: 'base'
  name: 'compute-slurm'
  publish_tags:
    - '8.10'
    - 'latest'
  pkg_manager: 'dnf'
  parent: 'registry.dist.si.usrc/stratus/compute-mlnx:8.10'
  registry_opts_pull:
    - '--tls-verify=false'

  # Publish to SI registry
  publish_registry: 'registry.dist.si.usrc:5000/stratus'
  registry_opts_push:
    - '--tls-verify=false'

      #repos:
      #  - alias: 'elrepo'
      #    url: 'http://elrepo.org/linux/elrepo/el8/x86_64/'

packages:
  - elrepo-release
  - slurm-ohpc
  - slurm-slurmd-ohpc
  - slurm-example-configs-ohpc
  - kernel-headers
  - wireguard-tools
  - kmod-wireguard

copyfiles:
  - src: '/data/image-configs/files/id_rsa.pub'
    dest: '/root/.ssh/authorized_keys'
  - src: '/data/image-configs/files/cloud-init-override.conf'
    dest: '/etc/systemd/system/cloud-init.service.d/override.conf'
  - src: '/data/image-configs/files/ochami-ci-setup.sh'
    dest: '/usr/local/bin/ochami-ci-setup.sh'
  - src: '/data/image-configs/files/cloud-cfg-d-ochami.cfg.template'
    dest: '/etc/cloud/cloud.cfg.d/ochami.cfg.template'

cmds:
  - cmd: 'chown -R munge:munge /var/lib/munge'
  - cmd: 'chown -R munge:munge /var/log/munge'
  - cmd: 'chown -R munge:munge /etc/munge'
  - cmd: 'echo test123456 | passwd root --stdin'
